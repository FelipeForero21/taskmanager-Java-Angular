<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="dashboard-title">
      <h1>Dashboard</h1>
      <p>Resumen de tu productividad y tareas</p>
    </div>
    <button mat-raised-button color="primary" (click)="refreshDashboard()">
      <mat-icon>refresh</mat-icon>
      Actualizar
    </button>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Cargando datos del dashboard...</p>
  </div>

  <div *ngIf="error" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
    <button mat-button color="primary" (click)="refreshDashboard()">Reintentar</button>
  </div>

  <div *ngIf="!loading && !error" class="dashboard-content">
    <div class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon color="primary">assignment</mat-icon>
            <span class="stat-title">Total Tareas</span>
          </div>
          <div class="stat-value">{{ stats?.totalTasks || 0 }}</div>
          <div class="stat-description">Tareas en el sistema</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon color="accent">pending</mat-icon>
            <span class="stat-title">Pendientes</span>
          </div>
          <div class="stat-value">{{ stats?.pendingTasks || 0 }}</div>
          <div class="stat-description">Tareas por completar</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon color="primary">check_circle</mat-icon>
            <span class="stat-title">Completadas</span>
          </div>
          <div class="stat-value">{{ stats?.completedTasks || 0 }}</div>
          <div class="stat-description">Tareas finalizadas</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon color="warn">warning</mat-icon>
            <span class="stat-title">Vencidas</span>
          </div>
          <div class="stat-value">{{ stats?.overdueTasks || 0 }}</div>
          <div class="stat-description">Tareas fuera de plazo</div>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="productivity-section">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Productividad</mat-card-title>
          <mat-card-subtitle>Métricas de rendimiento</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="productivity-grid">
            <div class="productivity-item">
              <div class="productivity-label">Tasa de Completación</div>
              <div class="productivity-value">
                <mat-progress-bar 
                  [value]="stats?.completionRate || 0" 
                  [color]="getCompletionRateColor(stats?.completionRate || 0)">
                </mat-progress-bar>
                <span class="progress-text">{{ stats?.completionRate || 0 }}%</span>
              </div>
            </div>

            <div class="productivity-item">
              <div class="productivity-label">Tareas Hoy</div>
              <div class="productivity-value">{{ productivityMetrics?.tasksCompletedToday || 0 }}</div>
            </div>

            <div class="productivity-item">
              <div class="productivity-label">Tareas Esta Semana</div>
              <div class="productivity-value">{{ productivityMetrics?.tasksCompletedThisWeek || 0 }}</div>
            </div>

            <div class="productivity-item">
              <div class="productivity-label">Promedio Diario</div>
              <div class="productivity-value">{{ productivityMetrics?.averageTasksPerDay || 0 }}</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="tasks-section">
      <div class="tasks-column">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Tareas Recientes</mat-card-title>
            <mat-card-subtitle>Últimas tareas actualizadas</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <mat-list>
              <mat-list-item *ngFor="let task of recentTasks" class="task-item">
                <mat-icon matListItemIcon [style.color]="task.taskStatus.colorHex">assignment</mat-icon>
                <div matListItemTitle>{{ task.title }}</div>
                <div matListItemLine>
                  <mat-chip [color]="getStatusColor(task.taskStatus.statusName)" selected>
                    {{ task.taskStatus.statusName }}
                  </mat-chip>
                  <mat-chip [color]="getPriorityColor(task.taskPriority.priorityName)" selected>
                    {{ task.taskPriority.priorityName }}
                  </mat-chip>
                </div>
              </mat-list-item>
              <mat-list-item *ngIf="recentTasks.length === 0">
                <div matListItemTitle>No hay tareas recientes</div>
              </mat-list-item>
            </mat-list>
          </mat-card-content>
        </mat-card>
      </div>

      <div class="tasks-column">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Próximas Tareas</mat-card-title>
            <mat-card-subtitle>Tareas que vencen pronto</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <mat-list>
              <mat-list-item *ngFor="let task of upcomingTasks" class="task-item">
                <mat-icon matListItemIcon [style.color]="task.taskPriority.colorHex">schedule</mat-icon>
                <div matListItemTitle>{{ task.title }}</div>
                <div matListItemLine>
                  <span class="due-date">{{ task.dueDate | date:'shortDate' }}</span>
                  <mat-chip [color]="getPriorityColor(task.taskPriority.priorityName)" selected>
                    {{ task.taskPriority.priorityName }}
                  </mat-chip>
                </div>
              </mat-list-item>
              <mat-list-item *ngIf="upcomingTasks.length === 0">
                <div matListItemTitle>No hay tareas próximas</div>
              </mat-list-item>
            </mat-list>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>
